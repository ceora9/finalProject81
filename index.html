<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>Take Care</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <script src="https://code.jquery.com/jquery-3.5.0.js"></script>
        <link rel="stylesheet" href="style.css">
        <link rel="preconnect" href="https://fonts.gstatic.com">
        <link href="https://fonts.googleapis.com/css2?family=Fira+Sans:wght@300&family=Oxygen&display=swap" rel="stylesheet">
        
        <script>
            $(document).ready(() => {

                $("#submit").click(() => {
                    addCustom()
                });

                $("#add").click(() => {
                    addSelected()
                });

        //         $('#form :checked').each(function() {
        //    allVals.push($(this).val());
        //  });

        function addSelected() {
                    let activity = $("#form :checked").val(); 
                    let postData = JSON.stringify({
                        "activity": activity,
                    });

                        $.ajax({           
                            url: "/activity",
                            type: "POST",
                            data: postData,
                            contentType:"application/json",

                            success: (res, status) => {

                            $("#custom").append(`<li class="custom">${activity}</li>`);
                            $("#form :checked").val("");
                        },
                        error: (xhr, _, err) => {
                            
                            if (xhr.status == 400) {
                                alert(`${err}: item already exists!`);
                            }
                        }
                        })
                    }

                function addCustom() {
                    let activity = $("#item").val()
                    if (activity.length < 1) {
                        alert("Please enter a custom item.")
                        return
                    }

                    let postData = JSON.stringify({
                        "activity": activity,
                    })

                    $.ajax({
                        url: "/activity",
                        type: "POST",
                        data: postData,
                        contentType:"application/json",
                        success: (res, status) => {
                            $("#custom").append(`<li class="custom">${activity}</li>`);
                            $("#item").val("");
                        },
                        error: (xhr, _, err) => {
                            
                            if (xhr.status == 400) {
                                alert(`${err}: item already exists!`);
                            }
                        }
                    })
                }

                $("#clear").click(() => {
                    $.ajax({
                        url: "/activities",
                        type: "DELETE",
                        success: function(res, status){
                            $("#custom").html("");
                            $("#goal").html("");
                        }
                    })
                });

                $("#custom").on('click', 'li.custom', (event) => {
                    let activity = $(event.target).text();
                    $.ajax({
                        url: `/activity/custom/${activity}`,
                        type: "DELETE",
                        success: function(res, status){
                            $(event.target).remove();
                            $("#goal").append(`<li class="goal">${activity}</li>`)
                        }
                    })
                });

                $("#goal").on('click', 'li.goal', (event) => {
                    let activity = $(event.target).text();
                    $.ajax({
                        url: `/activity/goal/${activity}`,
                        type: "DELETE",
                        success: function(res, status){
                            $(event.target).remove();
                        }
                    })
                });

                $.get("/activities", (response, status) => {
                    let selectedActivities = response.selected;
                    for (let activity of selectedActivities) {
                        $("#goal").append(`<li class="goal">${activity}</li>`)
                    }
                    let customActivities = response.custom;
                    for (let activity of customActivities) {
                        $("#custom").append(`<li class="custom">${activity}</li>`)
                    }
                    let goalActivities = response.goal;
                    for (let activity of goalActivities) {
                        $("#goal").append(`<li class="goal">${activity}</li>`)
                    }
                });

                $.delete = (url, callback, type) => {
                    return $.ajax({
                        url: url,
                        type: 'DELETE',
                        success: callback,
                        data: {},
                        contentType: type
                    });
                }
            });
        </script>
    </head>
    <body>
        <h1>Take Care</h1>
        <h3><i>Take Care</i> helps you track your self-care activities.</h3>
        <p>Personalize your list of self-care activities, create daily and weekly goals, and set reminders to help you stay on your path.</p>
        
        <div class="activities-list">
            <h4>Make selections from the activities below.<br>Prioritize items that will have the biggest impact on your self-care routine.</h4>
            <form id="form">
                <h3>Exercise</h3>
                <input type="checkbox" name="run" value="run">
                <label for="run">run</label><br>

                <input type="checkbox" name="dance" value="dance">
                <label for="dance">dance</label><br>

                <input type="checkbox" name="yoga" value="yoga">
                <label for="yoga">yoga</label><br>

                <h3>Sleep</h3>

                <input type="checkbox" id="yoga" value="yoga">
                <label for="yoga">yoga</label><br>

                <input type="checkbox" id="breathing-exercises" value="breathing-exercises">
                <label for="breathing-exercises">breathing exercises</label><br>

                <h3>Nutrition</h3>

                <input type="checkbox" id="water" value="water">
                <label for="water">drink 8 glasses of water</label><br>

                <input type="checkbox" id="vegetables" value="vegetables">
                <label for="vegetables">eat 5 servings of fruits and vegetables</label><br>

                <h3>Recreation & Relaxation</h3>

                <input type="checkbox" id="hiking" value="hiking">
                <label for="hiking">hiking</label><br>

                <input type="checkbox" id="meditate" value="meditate">
                <label for="meditate">meditate</label><br>

                <input type="checkbox" id="beach" value="beach">
                <label for="beach">take a walk on the beach</label><br>

                <input type="checkbox" id="biking" value="biking">
                <label for="biking">biking</label><br> 
                
                <button id="add" type="button">Add</button>
            </form>

        <h3>Add custom self-care items:</h3>

        <div id="addItem">
            activity:
            <input id="item" type="text" name="add_item"/>
            <button id="submit" type="button">Submit</button>
            <button id="clear" type="button">Clear All</button>
        </div>
        <div>
            <h4>Custom:</h4>
            <ul id="custom"></ul>
        </div>

        <h4>What will you do today to take care of yourself?</h4>
        
        <div>
            <h4>Goal:</h4>
            <ul id="goal"></ul>
        </div>

        <div class="notifications"></div>

        <div class="progress"></div>

        <!-- <script src="app.js" async defer></script> -->

    </body>
</html>